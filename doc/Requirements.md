# NextRound Tasks 要件定義（MVP / 確定版）

## 0. ブランド方針（最優先）
- 親ブランド名: `NextRound`
- 親ブランドのコンセプト: 格闘ゲームを続けるための基盤
- 親ブランドの目的:
  - 「情報がなくて止めた」を減らす
  - 「強くなれなくて止めた」を減らす
  - 結果として「格闘ゲームをやめないでほしい」
- 本アプリ名: `NextRound Tasks`
- 本アプリの役割: 1日ひとつ強くなる（小さく積み上げて継続を支える）
- 本アプリの世界観コピー: 「少しずつ強くなっていく。それがいいんだ。」
- 関連アプリ名: `NextRound Combos`
- 関連アプリの役割: 情報を伝えあう（コンボ等のレシピ共有・発見・取り込みを促す）
- 関連アプリの世界観コピー: 「もっと強くなれる。俺も、お前も。」
- 判断原則: 機能仕様よりも上記の意図・世界観を優先し、迷った場合は「格闘ゲームを続けるための基盤」に立ち返る。

## 1. 目的
格闘ゲームの練習課題（タスク）ごとに「成功回数」をカウントし、十分練習できたタスクを完了（非表示化）できるツールを提供する。

---

## 2. スコープ

### 2.1 Must（実装する）
1. タスク作成
2. タスクごとの成功回数カウント（増加のみ）
3. タスクごとの手動リセット（成功回数を0に戻す）
4. タスク完了（非表示化）
5. 完了タスクの復活（復活時にcountは保持）
6. 完了タスクの削除（確認後に永久削除）
7. タスクリスト作成（自由記述の1入力欄）
8. タスクリスト切替（リストごとにタスクを分離）
9. データのエクスポート（JSONバックアップ）
10. データのインポート（新しいタスクリストとして追加）
11. タスクリスト名の変更（`...` メニュー）
12. タスクリスト削除（`...` メニュー、最後の1件は不可）
13. NextRound Combos への公開/検索遷移（`return_to` 付き）
14. 共有アプリ復帰時の取り込み（`imported=1` かつ `list_id` 指定時）
15. タスクリスト説明（長文テキスト）の作成・保存・表示

### 2.2 Won’t（実装しない）
- タグ付け、検索、並び替え、複数リスト
- ログイン、クラウド同期、複数端末連携
- リマインド、タイマー、分析ダッシュボード
- 全体（日次）リセット、自動日付切替リセット
- 高度なセキュリティ対策（秘匿情報として扱わない）

---

## 3. 前提・制約（非機能）
- 実行環境：ブラウザ（静的ホスティング / GitHub Pages等を想定）
- 永続化：各ブラウザの localStorage に保存
- 認証：なし
- データ特性：端末/ブラウザ単位で保持。ブラウザデータ削除・別端末・別ブラウザでは引き継がれない。
- ブランチ運用：変更は `develop` で検証後に `main` へ反映する。
- 公開運用：GitHub Pages は `main` ブランチ公開固定とする。

---

## 4. 画面要件（最小構成）

### 4.1 画面A：アクティブタスク一覧
- 左上にハンバーガーメニュー（データ管理）を表示
- 右上に現在のタスクリスト名を表示し、切替UIを提供
- タスク追加（タスク名入力＋追加）
- アクティブタスクの一覧表示
- 各タスクに以下の操作/表示を持つ：
  - タスク名（title）
  - `成功！`（初回表示）/ `n回`（押下後表示）
  - `リセット`（成功回数を0に戻す）
  - `完了`（完了状態にする＝非表示化）

※ `-1`（減算）は提供しない。

### 4.2 画面B：完了タスク一覧
- 完了タスクの一覧表示
- 各タスクに以下の操作/表示を持つ：
  - タスク名（title）
  - `削除`（確認後に永久削除）
  - `復活`（アクティブに戻す）

### 4.3 タスクリスト管理UI
- 自由記述の1入力欄でタスクリストを作成できる
- 作成済みタスクリストを選択して切替できる
- 各リスト行の右端 `...` から `名前変更` / `削除` を実行できる
- リスト名の前後空白は除去して保存する
- 空文字は作成不可
- 同名タスクリストは作成不可
- タスクリスト削除時は確認ダイアログを表示する
- 最後の1件のタスクリストは削除不可

### 4.4 タスクリスト説明UI（メイン画面）
- アクティブ/完了タスク一覧の下部に、現在選択中リストの説明欄を表示する
- 説明欄は長文テキスト入力（textarea）で編集できる
- `説明を保存` 操作で `currentList.description` に保存できる
- リスト切替時は説明欄の内容も切り替わる

### 4.5 データ管理UI（ハンバーガーメニュー）
- メニュー項目は `データをエクスポート` / `データをインポート` / `このタスクリストを公開（NextRound Combosに移動）` / `タスクリストを検索（NextRound Combosに移動）`
- `データをエクスポート` は JSON ファイルをダウンロードする
- `データをインポート` は JSON ファイルを選択後、確認ダイアログで追加可否を確認する
- インポート済みリスト名が既存と重複する場合は `リスト名(1)` のように連番を付与する
- 公開/検索は外部共有アプリへ遷移し、戻り先として `return_to` に現在URLを付与する
- オフライン時は外部遷移を行わず、ローカル編集継続メッセージを表示する

---

## 5. データ要件（localStorage）

### 5.1 Taskモデル
- id: string（一意）
- title: string
- status: "active" | "done"
- count: number（0以上）
- listId: string（所属タスクリストID）

### 5.2 TaskListモデル
- id: string（一意）
- name: string（自由記述）
- description: string（任意、長文可）
- createdAt: number（UNIX ms）

### 5.3 保存形式
- localStorage key（例）：`fg_task_manager_v1`
- value（JSON）：
  - schemaVersion: number（=2）
  - currentListId: string
  - lists: TaskList[]
  - tasks: Task[]

---

## 6. ユースケース / 受け入れ条件（Acceptance Criteria）

### UC1：タスク作成
- ユーザーがタスク名を入力して追加できる
- 追加直後は `status=active` かつ `count=0`

### UC2：成功回数カウント（増加のみ）
- `+1` 操作で対象タスクの `count` が 1 増える
- 減算操作は存在しない

### UC3：個別手動リセット
- `リセット` 操作で対象タスクの `count` が 0 になる
- 他のタスクには影響しない

### UC4：完了（非表示化）
- `完了` 操作で対象タスクの `status` が `done` になる
- アクティブ一覧から消え、完了一覧に表示される
- データは保持される（復活できるため）

### UC5：復活
- `復活` 操作で対象タスクの `status` が `active` になる
- アクティブ一覧に戻る
- 復活時に `count` は保持され、変更されない

### UC6：削除（永久削除）
- 完了タスクで `削除` 操作を押すと確認ダイアログが表示される
- 確認後、対象タスクはデータから削除される
- 削除されたタスクはリロード後も復元されない

### UC7：タスクリスト作成
- ユーザーは自由記述の1入力欄でタスクリストを作成できる
- 前後空白を除去した結果が空文字の場合は作成できない
- 既存と同名のタスクリストは作成できない
- 作成直後はそのタスクリストが選択状態になる

### UC8：タスクリスト切替
- 選択したタスクリストに対応するタスクのみ表示される
- 別タスクリストのタスクは表示されない
- リロード後も最後に選択したタスクリストが復元される

### UC8-1：タスクリスト説明編集
- メイン画面下部の説明欄で、現在選択中リストの説明を編集できる
- `説明を保存` を押すと `lists[].description` が更新される
- 説明を空欄で保存すると、説明は空文字として保存される

### UC9：データエクスポート
- ハンバーガーメニューから `データをエクスポート` を実行できる
- 現在の状態（lists/currentListId/tasks）を JSON として保存できる
- `lists[].description` を JSON に含める

### UC10：データインポート
- ハンバーガーメニューから `データをインポート` を実行できる
- ファイル選択後に「新しいタスクリストとして追加する」確認ダイアログを表示する
- 確認後に有効な JSON を読み込むと、既存データを保持したままタスクリストとタスクが追加される
- `lists[].description` を取り込んで保持する（欠落時は空文字として扱う）
- インポートリスト名が既存と重複する場合は `リスト名(1)` / `リスト名(2)` のように連番を付けて追加する
- 無効な JSON の場合は失敗を通知し、状態を変更しない

### UC11：タスクリスト名変更
- タスクリスト行の `...` メニューから `名前変更` を実行できる
- 空文字への変更は不可
- 既存と同名への変更は不可
- 成功時は即時に表示へ反映される

### UC12：タスクリスト削除
- タスクリスト行の `...` メニューから `削除` を実行できる
- 削除前に確認ダイアログを表示する
- 削除されたリストに属するタスクも削除される
- 現在選択中リストを削除した場合は、別リストへ自動切替される
- 最後の1件のリストは削除できない

### UC13：共有アプリへの公開/検索遷移
- メニューから公開/検索を実行すると `NextRound Combos` のUIへ遷移する
- 遷移URLには `return_to` が含まれ、Tasks側URLへ戻せる
- オフライン時は遷移せず、ユーザーへ案内メッセージを表示する
- 公開時に送る `payload_json.lists[]` へ `description` を含める

### UC14：共有アプリ復帰時インポート
- `imported=1` かつ `list_id`（`listId` / `share_list_id` も許容）を含むURLで復帰した場合、`/lists/{id}` を取得して `payload_json` をTasks状態へマージする
- 取り込み成功時は「タスクリストをインポートしました」を表示し、URLクエリを除去する
- `list_id` 不在または取得失敗時は失敗メッセージを表示し、状態を変更しない
- `payload_json.lists[].description` をローカル状態へ反映する（欠落時は空文字）

### 永続化（共通）
- ブラウザをリロードしても、タスク一覧・count・statusが保持される（localStorage）
